{% extends 'base.html' %}

{% block content %}
<style>
    .heatmap-container {
        width: 80%;
        height: 300px; /* 고정 높이 */
}

    .heatmap-tooltip {
        font-size: 14px;
        font-family: Arial, sans-serif;
}
</style>
<div class="w-full max-w-7xl mx-auto grid grid-cols-1 gap-6 md:grid-rows-2">
    <!-- 상단: 최근 일기와 감정 통계 -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- 최근 작성한 일기 -->
        <div class="bg-white rounded-xl shadow-md p-6 h-[400px] flex flex-col">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">최근 작성한 일기</h2>
            <div class="flex-1 overflow-y-auto">
                {% if recent_diaries %}
                    <ul class="space-y-4">
                        {% for diary in recent_diaries %}
                        <li class="p-4 bg-gray-50 rounded-lg shadow-sm">
                            <p class="text-sm text-gray-500">{{ diary.diary_date }}</p>
                            <p class="text-gray-700 mt-2">{{ diary.content|default:"내용 미리보기가 없습니다." }}</p>
                            <a href="{% url 'diary_detail' diary.diary_id %}" class="text-purple-500 text-sm font-semibold hover:underline mt-2 block">자세히 보기</a>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-gray-600">작성된 일기가 없습니다.</p>
                {% endif %}
            </div>
        </div>

        <!-- 감정 통계 -->
        <div class="bg-white rounded-xl shadow-md p-6 h-[400px] flex flex-col">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">감정 통계</h2>
            <div class="flex-1 grid grid-cols-3 gap-4">
                {% for emotion, score in emotion_statistics.items %}
                <div class="bg-purple-50 text-purple-700 p-4 rounded-lg text-center shadow-sm">
                    <p class="font-semibold">{{ emotion }}</p>
                    <p class="text-lg font-bold">{{ score }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- 하단: 히트맵 -->
    <div class="bg-white rounded-xl shadow-md p-6 h-[420px]">
        <div id="cal-heatmap" class="w-[400px] flex-1"></div>
    </div>
</div>

<!-- JavaScript for Heatmap -->
<script src="https://unpkg.com/cal-heatmap/dist/cal-heatmap.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/cal-heatmap/dist/cal-heatmap.css">
<script>
    document.addEventListener("DOMContentLoaded", function () {
        {#const rawData = JSON.parse('{{ heatmap_data|safe }}'); // JSON 데이터 로드#}
        {#const heatmapData = Object.fromEntries(#}
        {#    Object.entries(rawData).map(([key, value]) => [new Date(key).getTime() / 1000, value])#}
        {#)#}
        const heatmapData = {
                1730851200: 1,
                1733011200: 1,
                1733097600: 1,
                1733356800: 1
        };
        console.log(heatmapData)

        const heatmap = new CalHeatmap();

        heatmap.paint({
            range:1,
            domain:{type:"month", sort: "asc" },
            subDomain: {type:"day", radius:5,},
            data: {
                source: heatmapData,
                type: "json",
            },
            container: "#cal-heatmap",
            date:{
                start: new Date(new Date().setFullYear(new Date().getFullYear())),
            },
            theme: 'light',
            scale:{
                color:{
                    range: ['yellow', "orange", 'red'],
                    domain:[0, 5],
                }
            },
            itemSelector: "#cal-heatmap",
        });

    });
</script>
{% endblock %}